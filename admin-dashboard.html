<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù„Ø¨Ø§Ø³ Ø³Ø±Ø§ÛŒ Ø§Ø±ØªØ§</title>
    <link rel="stylesheet" href="style.css">

    <style>
        .btn-del, .btn-edit {
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            margin: 0 2px;
        }
        .btn-del {
            background: #e91e63;
            color: #fff;
        }
        .btn-del:hover {
            background: #c2185b;
        }
        .btn-edit {
            background: #2196F3;
            color: #fff;
        }
        .btn-edit:hover {
            background: #1976D2;
        }
        /* Ø³Ø¨Ú© Ù…ÙˆØ¯Ø§Ù„ */
        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, .45)
        }
        .modal-content {
            background: #fff;
            margin: 10% auto;
            padding: 20px;
            width: 320px;
            border-radius: 8px;
            direction: rtl;
            text-align: right
        }
        .modal-content label, .modal-content input {
            width: 100%;
            margin: 6px 0
        }
        .close {
            float: left;
            font-size: 22px;
            cursor: pointer
        }
        table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        th {
            background: #f5f5f5;
        }
        img {
            width: 60px;
            border-radius: 8px;
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„ ØµÙØ­Ù‡â€ŒÛŒ Û´Û°Û³ */
        .access-denied {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: 'IRANSans', tahoma, sans-serif;
            background: #f3e5f5;
            color: #4a0072;
        }
        .access-denied h1 {
            margin-bottom: 1rem;
        }
        .access-denied button {
            padding: 0.5rem 1.5rem;
            font-size: 1rem;
            border-radius: 8px;
            border: none;
            background: #7b1fa2;
            color: #fff;
            cursor: pointer;
            transition: background .3s;
        }
        .access-denied button:hover {
            background: #4a0072;
        }
    </style>
</head>

<body>
    <!-- Ø¨Ø®Ø´ Ø§ØµÙ„ÛŒ Ù¾Ù†Ù„ (Ø¯Ø± ØµÙˆØ±Øª Ù„Ø§Ú¯ÛŒÙ† Ø¨ÙˆØ¯Ù†) -->
    <div id="adminPanel" class="admin-dashboard">
        <header>
            <h1>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù„Ø¨Ø§Ø³ Ø³Ø±Ø§ÛŒ Ø§Ø±ØªØ§</h1>
            <nav>
                <ul>
                    <li><a href="#">Ø®Ø§Ù†Ù‡</a></li>
                    <li><a href="#orders">Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´Ø§Øª</a></li>
                    <li><a href="#products">Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª</a></li>
                    <li><a href="#users">Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</a></li>
                    <li><a href="#" id="logoutBtn">Ø®Ø±ÙˆØ¬</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <!-- Ù…ÙˆØ¯Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„ -->
            <div id="editProductModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h3>ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„</h3>
                    <input type="hidden" id="editIndex">
                    <label>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„:<br><input id="editName"></label>
                    <label>Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†):<br><input id="editPrice" type="number"></label>
                    <label>ØªÙˆØ¶ÛŒØ­Ø§Øª:<br><input id="editDesc"></label>
                    <label>ØªØµÙˆÛŒØ± (URL ÛŒØ§ Base64):<br><input id="editImage"></label>
                    <button onclick="saveEdit()">Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª</button>
                </div>
            </div>

            <!-- Ø¨Ø®Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´Ø§Øª -->
            <section id="orders">
                <h2>Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</h2>
                <table id="ordersTable">
                    <thead>
                        <tr>
                            <th>Ø´Ù…Ø§Ø±Ù‡</th>
                            <th>Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ</th>
                            <th>Ù…Ø­ØµÙˆÙ„Ø§Øª</th>
                            <th>Ù…Ø¨Ù„Øº Ú©Ù„</th>
                            <th>Ø¢Ø¯Ø±Ø³</th>
                            <th>ØªÙ„ÙÙ†</th>
                            <th>ÙˆØ¶Ø¹ÛŒØª</th>
                            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </section>

            <!-- Ø¨Ø®Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª -->
            <section id="products">
                <h2>Ù…Ø­ØµÙˆÙ„Ø§Øª</h2>
                <table id="productsTable">
                    <thead>
                        <tr>
                            <th>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</th>
                            <th>Ù‚ÛŒÙ…Øª</th>
                            <th>ØªØµÙˆÛŒØ±</th>
                            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <h3>Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</h3>
                <form id="addProductForm">
                    <label>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„:<br><input type="text" id="productName" required></label>
                    <label>Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†):<br><input type="number" id="productPrice" required></label>
                    <label>ØªÙˆØ¶ÛŒØ­Ø§Øª:<br><input type="text" id="productDescription" required></label>
                    <label>ØªØµÙˆÛŒØ± Ù…Ø­ØµÙˆÙ„:<br><input type="file" id="productImage" required></label>
                    <button type="submit">Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„</button>
                </form>
            </section>
        </main>
    </div>

    <!-- ØµÙØ­Ù‡â€ŒÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ù…Ù†ÙˆØ¹ (Ø¯Ø± ØµÙˆØ±Øª Ø¹Ø¯Ù… Ù„Ø§Ú¯ÛŒÙ†) -->
    <div id="accessDenied" class="access-denied" style="display:none;">
        <h1>Û´Û°Û³ - Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ù…Ù†ÙˆØ¹</h1>
        <p>Ø´Ù…Ø§ Ù…Ø¬ÙˆØ² Ù„Ø§Ø²Ù… Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø±Ø§ Ù†Ø¯Ø§Ø±ÛŒØ¯.</p>
        <button onclick="location.href='login.html'">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯</button>
    </div>

    <script>
        /* ==================== Ú©Ù†ØªØ±Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ ==================== */
        (function () {
            const token = sessionStorage.getItem('artaAdminToken');
            if (!token) {
                document.body.innerHTML = '';
                document.body.className = 'access-denied';
                document.body.innerHTML = `
                    <h1>Û´Û°Û³ - Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ù…Ù†ÙˆØ¹</h1>
                    <p>Ø´Ù…Ø§ Ù…Ø¬ÙˆØ² Ù„Ø§Ø²Ù… Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø±Ø§ Ù†Ø¯Ø§Ø±ÛŒØ¯.</p>
                    <button onclick="location.href='login.html'">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯</button>
                `;
                throw new Error('Access Denied');
            }
        })();

        /* ==================== Ø®Ø±ÙˆØ¬ Ø§Ù…Ù† ==================== */
        document.getElementById('logoutBtn').addEventListener('click', function (e) {
            e.preventDefault();
            if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø®Ø±ÙˆØ¬ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                sessionStorage.removeItem('artaAdminToken');
                location.href = 'login.html';
            }
        });

        /* ==================== Ø­Ø°Ù Ø³ÙØ§Ø±Ø´ ==================== */
        function deleteOrder(idx) {
            if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ø³ÙØ§Ø±Ø´ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) return;
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            orders.splice(idx, 1);
            localStorage.setItem('orders', JSON.stringify(orders));
            loadOrders();
        }

        /* ==================== ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´ ==================== */
        function changeOrderStatus(idx) {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            if (orders[idx]) {
                orders[idx].status = orders[idx].status === 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´' ? 'Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡' : 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´';
                localStorage.setItem('orders', JSON.stringify(orders));
                loadOrders();
            }
        }

        /* ==================== Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³ÙØ§Ø±Ø´Ø§Øª ==================== */
        function loadOrders() {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const tbody = document.querySelector('#ordersTable tbody');
            tbody.innerHTML = '';

            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Ù‡ÛŒÚ† Ø³ÙØ§Ø±Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td></tr>';
                return;
            }

            orders.forEach((order, idx) => {
                const productsText = Array.isArray(order.products)
                    ? order.products.map(p => `${p.name} (${p.quantity || 1} Ø¹Ø¯Ø¯)`).join(' ØŒ ')
                    : (order.products || '---');

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${idx + 1}</td>
                    <td>${order.name || '---'}</td>
                    <td>${productsText}</td>
                    <td>${Number(order.totalPrice || 0).toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</td>
                    <td>${order.location || '---'}</td>
                    <td>${order.phone || '---'}</td>
                    <td>${order.status || 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´'}</td>
                    <td>
                        <button onclick="changeOrderStatus(${idx})">ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª</button>
                        <button class="btn-del" onclick="deleteOrder(${idx})">ğŸ—‘ Ø­Ø°Ù</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        /* ==================== ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„ ==================== */
        function editProduct(idx) {
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const p = products[idx];
            if (!p) return;

            document.getElementById('editIndex').value = idx;
            document.getElementById('editName').value = p.name;
            document.getElementById('editPrice').value = p.price;
            document.getElementById('editDesc').value = p.description || '';
            document.getElementById('editImage').value = p.image || '';
            document.getElementById('editProductModal').style.display = 'block';
        }

        function saveEdit() {
            const idx = document.getElementById('editIndex').value;
            const products = JSON.parse(localStorage.getItem('products')) || [];
            if (!products[idx]) return;

            products[idx].name = document.getElementById('editName').value.trim();
            products[idx].price = parseInt(document.getElementById('editPrice').value);
            products[idx].description = document.getElementById('editDesc').value.trim();
            products[idx].image = document.getElementById('editImage').value.trim();

            localStorage.setItem('products', JSON.stringify(products));
            document.getElementById('editProductModal').style.display = 'none';
            loadProducts();
        }

        /* ==================== Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„ ==================== */
        document.querySelector('#editProductModal .close').onclick = () =>
            document.getElementById('editProductModal').style.display = 'none';

        /* ==================== Ø­Ø°Ù Ù…Ø­ØµÙˆÙ„ ==================== */
        function deleteProduct(idx) {
            if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù…Ø­ØµÙˆÙ„ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) return;
            const products = JSON.parse(localStorage.getItem('products')) || [];
            products.splice(idx, 1);
            localStorage.setItem('products', JSON.stringify(products));
            loadProducts();
        }

        /* ==================== Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª ==================== */
        function loadProducts() {
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const tbody = document.querySelector('#productsTable tbody');
            tbody.innerHTML = '';

            if (products.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">Ù‡ÛŒÚ† Ù…Ø­ØµÙˆÙ„ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td></tr>';
                return;
            }

            products.forEach((p, idx) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${p.name}</td>
                    <td>${Number(p.price || 0).toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</td>
                    <td><img src="${p.image || 'images/no-image.png'}" alt="${p.name}"></td>
                    <td>
                        <button class="btn-edit" onclick="editProduct(${idx})">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                        <button class="btn-del" onclick="deleteProduct(${idx})">Ø­Ø°Ù</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        /* ==================== Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯ ==================== */
        document.getElementById('addProductForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const name = document.getElementById('productName').value.trim();
            const price = parseInt(document.getElementById('productPrice').value);
            const desc = document.getElementById('productDescription').value.trim();
            const fileInput = document.getElementById('productImage');

            if (!name || !price || !fileInput.files[0]) {
                alert("Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.");
                return;
            }

            const reader = new FileReader();
            reader.onload = function (ev) {
                const products = JSON.parse(localStorage.getItem('products')) || [];
                products.push({
                    id: Date.now(),
                    name: name,
                    price: price,
                    description: desc,
                    image: ev.target.result
                });
                localStorage.setItem('products', JSON.stringify(products));
                alert("Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡ Ø´Ø¯.");
                e.target.reset();
                loadProducts();
            };
            reader.readAsDataURL(fileInput.files[0]);
        });

        /* ==================== Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ==================== */
        document.addEventListener('DOMContentLoaded', () => {
            loadOrders();
            loadProducts();
        });
    </script>
</body>
</html>


      